<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><title>使用Docker快速搭建ZooKeeper集群 - Itlaohuo</title><meta name=Description content="Itlaohuo的博客"><meta property="og:title" content="使用Docker快速搭建ZooKeeper集群"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="/zookeeper-cluster-demo/"><meta property="og:image" content="/img/Kubenetes.assets/image-20200404094800622.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2023-08-15T12:14:55+08:00"><meta property="article:modified_time" content="2023-08-15T12:14:55+08:00"><meta property="og:site_name" content="Itlaohuo的博客"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/img/Kubenetes.assets/image-20200404094800622.png"><meta name=twitter:title content="使用Docker快速搭建ZooKeeper集群"><meta name=twitter:description content><meta name=application-name content="Itlaohuo的博客"><meta name=apple-mobile-web-app-title content="Itlaohuo的博客"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=/zookeeper-cluster-demo/><link rel=prev href=/demo-project-devops-record/><link rel=stylesheet href=/css/style.min.css><link rel=preload href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css></noscript><link rel=preload href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css as=style onload='this.onload=null,this.rel="stylesheet"'><noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css></noscript><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"使用Docker快速搭建ZooKeeper集群","inLanguage":"zh-CN","mainEntityOfPage":{"@type":"WebPage","@id":"\/zookeeper-cluster-demo\/"},"genre":"posts","keywords":"docker, docker compose, 容器编排","wordcount":2737,"url":"\/zookeeper-cluster-demo\/","datePublished":"2023-08-15T12:14:55+08:00","dateModified":"2023-08-15T12:14:55+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Itlaohuo"},"description":""}</script></head><body data-header-desktop=fixed data-header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem("theme")?localStorage.getItem("theme")==="dark":"auto"==="auto"?window.matchMedia("(prefers-color-scheme: dark)").matches:"auto"==="dark")&&document.body.setAttribute("theme","dark")</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title=Itlaohuo>Itlaohuo</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>文章 </a><a class=menu-item href=/tags/>标签 </a><a class=menu-item href=/categories/>分类 </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title=Itlaohuo>Itlaohuo</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw" aria-hidden=true></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw" aria-hidden=true></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin" aria-hidden=true></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>文章</a><a class=menu-item href=/tags/ title>标签</a><a class=menu-item href=/categories/ title>分类</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">使用Docker快速搭建ZooKeeper集群</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw" aria-hidden=true></i>Itlaohuo</a></span>&nbsp;<span class=post-category>included in <a href=/categories/%E7%AC%94%E8%AE%B0/><i class="far fa-folder fa-fw" aria-hidden=true></i>笔记</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw" aria-hidden=true></i>&nbsp;<time datetime=2023-08-15>2023-08-15</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden=true></i>&nbsp;2737 words&nbsp;
<i class="far fa-clock fa-fw" aria-hidden=true></i>&nbsp;6 minutes&nbsp;</div></div><div class="details toc" id=toc-static data-kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right" aria-hidden=true></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#背景>背景</a></li><li><a href=#1-docker-composeyml--文件>1. docker-compose.yml 文件</a><ul><li><a href=#编排配置说明>编排配置说明</a></li></ul></li><li><a href=#2-启动集群>2. 启动集群</a></li><li><a href=#3-检测集群状态>3. 检测集群状态</a></li><li><a href=#4-zookeeper-集群角色介绍>4. ZooKeeper 集群角色介绍</a></li><li><a href=#5-不宕机动态扩容和缩容>5. 不宕机动态扩容和缩容</a></li><li><a href=#6-过半机制>6. 过半机制</a></li><li><a href=#问题记录>问题记录</a><ul><li><a href=#1--client-port-not-found-in-server-configs>1 : Client port not found in server configs</a></li><li><a href=#2-keepererrorcode--reconfig-is-disabled>2 :KeeperErrorCode = Reconfig is disabled</a></li><li><a href=#3-insufficient-permission>3: Insufficient permission</a></li></ul></li></ul></nav></div></div><div class=content id=content><h1 id=使用docker快速搭建zookeeper集群>使用Docker快速搭建ZooKeeper集群</h1><h2 id=背景>背景</h2><ul><li>使用Docker 安装zookeeper只是安装单机的。现在，我们要用 docker-compose 来编排集群容器。因为一个一个地启动 ZK 太麻烦了.</li></ul><h2 id=1-docker-composeyml--文件>1. docker-compose.yml 文件</h2><ul><li>首先创建一个名为 docker-compose.yml 的文件, 其内容如下:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2181:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2182 server.3=zoo3:2888:3888;2183 server.4=zoo4:2888:3888;2184</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2182:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2182 server.3=zoo3:2888:3888;2183 server.4=zoo4:2888:3888;2184</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w> 
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2183:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2182 server.3=zoo3:2888:3888;2183 server.4=zoo4:2888:3888;2184</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo4</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2184:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2182 server.3=zoo3:2888:3888;2183 server.4=zoo4:2888:3888;2184</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><h3 id=编排配置说明>编排配置说明</h3><ul><li>1、version: 版本号，一般来说，和你的 Docker Engine 的版本相匹配；这里选择 3；</li><li>2、image: 镜像版本：默认使用的是latest版本，可缺省；</li><li>3、ZOO_MY_ID（环境变量），该id在集群中必须是唯一的，并且其值应介于1和255之间；
请注意，如果使用已包含 myid 文件的 /data 目录启动容器，则此变量将不会产生任何影响。相当于你在zoo.cfg中指定的dataDir目录中创建文件myid，并且文件的内容就是范围为1到255的整数；</li><li>4、ZOO_SERVERS（环境变量）:</li></ul><blockquote><ul><li>此变量允许您指定Zookeeper集群的计算机列表；</li><li>每个条目都应该这样指定：server.id=<address1>:<port1>:<port2>[:role];[<client port address>:]<client port> 条目间空格分隔</li><li>id 是一个数字，表示集群中的服务器ID；</li><li>address1表示这个服务器的ip地址；</li><li>集群通信端⼝: port1 表示这个服务器与集群中的 Leader 服务器交换信息的端口；</li><li>集群选举端⼝: port2 表示万一集群中的 Leader 服务器挂了，需要一个端口来重新进行选举，选出一个新的 Leader，而这个端口就是用来执行选举时服务器相互通信的端口；</li><li>role: 默认是 participant,即参与过半机制的⻆⾊，选举，事务请求过半提交，还有⼀个是observer, 观察者，不参与选举以及过半机制。</li><li>client port address 是可选的，如果未指定，则默认为 “0.0.0.0” ；</li><li>client port 位于分号的右侧。从3.5.0开始，zoo.cfg中不再使用clientPort和clientPortAddress配置参数。作为替代，client port 用来表示客户端连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求。</li></ul></blockquote><ul><li>请注意，如果使用已包含zoo.cfg文件的/conf目录启动容器，则此变量不会产生任何影响。换句话说，zoo.cfg文件中包含集群的计算机列表，此时该环境变量不生效。</li></ul><h2 id=2-启动集群>2. 启动集群</h2><ul><li>打开命令行提示符，进入 docker-compose.yml 所在的目录，接着执行<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker-compose -f docker-compose.yml up
</span></span></code></pre></td></tr></table></div></div></li><li>最后检查一下运行情况：容器 zoo1,zoo2,zoo3,zoo4 都在运行中。</li></ul><h2 id=3-检测集群状态>3. 检测集群状态</h2><ul><li><p>检测集群状态的命令是 zkServer.sh status /conf/zoo.cfg。使用该命令的前提是要先登入容器中，可以使用 <code>docker exec -it zoo1 bash</code> 登入 zoo1 中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Shell data-lang=Shell><span class=line><span class=cl>he@LAPTOP-0PME2UF0:~$ docker <span class=nb>exec</span> -it zoo1 bash
</span></span><span class=line><span class=cl>root@aaa4ead811f0:/apache-zookeeper-3.8.2-bin# zkServer.sh status /conf/zoo.cfg
</span></span><span class=line><span class=cl>ZooKeeper JMX enabled by default
</span></span><span class=line><span class=cl>Using config: /conf/zoo.cfg
</span></span><span class=line><span class=cl>Client port found: 2181. Client address: localhost. Client SSL: false.
</span></span><span class=line><span class=cl>Mode: follower
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>he@LAPTOP-0PME2UF0:~$ docker <span class=nb>exec</span> -it zoo2 bash
</span></span><span class=line><span class=cl>root@14fc28ab859e:/apache-zookeeper-3.8.2-bin# zkServer.sh status /conf/zoo.cfg
</span></span><span class=line><span class=cl>ZooKeeper JMX enabled by default
</span></span><span class=line><span class=cl>Using config: /conf/zoo.cfg
</span></span><span class=line><span class=cl>Client port found: 2182. Client address: localhost. Client SSL: false.
</span></span><span class=line><span class=cl>Mode: follower
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>he@LAPTOP-0PME2UF0:~$ docker <span class=nb>exec</span> -it zoo3 bash
</span></span><span class=line><span class=cl>root@7d5c0792e1d5:/apache-zookeeper-3.8.2-bin# zkServer.sh status /conf/zoo.cfg
</span></span><span class=line><span class=cl>ZooKeeper JMX enabled by default
</span></span><span class=line><span class=cl>Using config: /conf/zoo.cfg
</span></span><span class=line><span class=cl>Client port found: 2183. Client address: localhost. Client SSL: false.
</span></span><span class=line><span class=cl>Mode: follower
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>he@LAPTOP-0PME2UF0:~$ docker <span class=nb>exec</span> -it zoo4 bash
</span></span><span class=line><span class=cl>root@30e423d9997b:/apache-zookeeper-3.8.2-bin# zkServer.sh status /conf/zoo.cfg
</span></span><span class=line><span class=cl>ZooKeeper JMX enabled by default
</span></span><span class=line><span class=cl>Using config: /conf/zoo.cfg
</span></span><span class=line><span class=cl>Client port found: 2184. Client address: localhost. Client SSL: false.
</span></span><span class=line><span class=cl>Mode: leader
</span></span></code></pre></td></tr></table></div></div></li></ul><h2 id=4-zookeeper-集群角色介绍>4. ZooKeeper 集群角色介绍</h2><ul><li>Zookeeper 集群模式⼀共有三种类型的⻆⾊：</li><li>Leader : 处理所有的事务请求（写请求），可以处理读请求，集群中只能有⼀个Leader</li><li>Follower : 只能处理读请求，同时作为 Leader的候选节点，即如果Leader宕机，Follower节点要参与到新的Leader选举中，有可能成为新的Leader节点。|</li><li>Observer : 只能处理读请求。不能参与选举|</li></ul><h2 id=5-不宕机动态扩容和缩容>5. 不宕机动态扩容和缩容</h2><ul><li><p>ZooKeeper 支持通过修改 zoo.cfg 并重启来改变ZooKeeper集群中的服务器，但是这种方式，不是很方便，上线一台服务器或者下线一台服务器需要对所有的服务器进行重启。</p></li><li><p>ZooKeeper 3.5.0 提供了⽀持动态扩容/缩容的新特性。但是通过客户端 API可以变更服务端集群状态是件很危险的事情，所以在ZooKeeper 3.5.3 版本要⽤动态配置，需要开启超级管理员身份验证模式 ACLs。</p></li><li><p>关于ZooKeeper的ACL权限控制，</p></li><li><p>Step1: 我为 super:qwer1234 生成了 digest 为 super:YjJhp1/a1jnzeGTDN7nAUxFcep8=；</p></li><li><p>Step2: <code>docker-compose -f docker-compose.yml down</code> 停掉并删除原来的容器；</p></li><li><p>Step3: 修改 docker-compose.yml 的内容：</p></li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;3&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>services</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo1</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2181:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181 server.4=zoo4:2888:3888;2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_CFG_EXTRA</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;reconfigEnabled=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>JVMFLAGS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:YjJhp1/a1jnzeGTDN7nAUxFcep8=&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo2</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2182:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181 server.4=zoo4:2888:3888;2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_CFG_EXTRA</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;reconfigEnabled=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>JVMFLAGS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:YjJhp1/a1jnzeGTDN7nAUxFcep8=&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo3</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2183:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181 server.4=zoo4:2888:3888;2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_CFG_EXTRA</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;reconfigEnabled=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>JVMFLAGS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:YjJhp1/a1jnzeGTDN7nAUxFcep8=&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>zoo4</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>zookeeper</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>restart</span><span class=p>:</span><span class=w> </span><span class=l>always</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>container_name</span><span class=p>:</span><span class=w> </span><span class=l>zoo4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span>- <span class=s2>&#34;2184:2181&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>environment</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_MY_ID</span><span class=p>:</span><span class=w> </span><span class=m>4</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_SERVERS</span><span class=p>:</span><span class=w> </span><span class=l>server.1=zoo1:2888:3888;2181 server.2=zoo2:2888:3888;2181 server.3=zoo3:2888:3888;2181 server.4=zoo4:2888:3888;2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>ZOO_CFG_EXTRA</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;reconfigEnabled=true&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>            </span><span class=nt>JVMFLAGS</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:YjJhp1/a1jnzeGTDN7nAUxFcep8=&#34;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><ul><li>ZOO_CFG_EXTRA: &ldquo;reconfigEnabled=true&rdquo; 开启了默认关闭的客户端 reconfig API</li><li>JVMFLAGS: &ldquo;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:YjJhp1/a1jnzeGTDN7nAUxFcep8=&rdquo; 设置了超级管理员账号为 super，明文密码为 qwer1234</li></ul></blockquote><ul><li>Step4: 重启集群
在 docker-compose.yml 所在目录执行以下命令：</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>docker-compose -f docker-compose.yml up
</span></span></code></pre></td></tr></table></div></div><ul><li><p>Step5: 登录客户端 ,使用如下命令在容器内连接该节点的 ZooKeeper 服务</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>zkCli.sh -server localhost:2181
</span></span></code></pre></td></tr></table></div></div></li><li><p>接下来就是使用ZooKeeper客户端的reconfig命令了。</p></li></ul><blockquote><p>5.1 查看当前集群信息
<code>get /zookeeper/config</code> 执行结果如下：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[zk: localhost:2181(CONNECTED) 0] get /zookeeper/config
</span></span><span class=line><span class=cl>server.1=zoo1:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.2=zoo2:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.3=zoo3:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.4=zoo4:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>version=100000000
</span></span></code></pre></td></tr></table></div></div><blockquote><p>5.2 扩缩容前的认证超级管理员身份 ,客户端命令行执行<code>addauth digest super:qwer1234</code>
5.3 移除集群中的一台服务器 <code>reconfig -remove &lt;id></code>比如说，从集群中移除ID为3的ZooKeeper服务：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[zk: localhost:2181(CONNECTED) 6] reconfig -remove 3
</span></span><span class=line><span class=cl>Committed new configuration:
</span></span><span class=line><span class=cl>server.1=zoo1:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.2=zoo2:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.4=zoo4:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>version=300000001
</span></span></code></pre></td></tr></table></div></div><blockquote><p>5.4 为集群新增一台服务器</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>reconfig -add server.id=&lt;address1&gt;:&lt;port1&gt;:&lt;port2&gt;[:role];[&lt;client port address&gt;:]&lt;client port&gt;
</span></span></code></pre></td></tr></table></div></div><blockquote><p>比如说，把刚才移除的服务器再添加回来：</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[zk: localhost:2181(CONNECTED) 7] reconfig -add server.3=zoo3:2888:3888;2181
</span></span><span class=line><span class=cl>Committed new configuration:
</span></span><span class=line><span class=cl>server.1=zoo1:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.2=zoo2:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.3=zoo3:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>server.4=zoo4:2888:3888:participant;0.0.0.0:2181
</span></span><span class=line><span class=cl>version=400000001
</span></span></code></pre></td></tr></table></div></div><h2 id=6-过半机制>6. 过半机制</h2><p>participant ⻆⾊能够形成集群（过半机制），如果集群内的 participant 有一半及以上都宕机了，此时客户端将不再可用。</p><blockquote><p>6.1 半数服务器宕机
比如说，停掉了 zoo3 和 zoo4：此时，没有停掉的服务，也启动不了客户端：</p></blockquote><blockquote><p>6.2 半数以上服务器可用,然后重启了 zoo3：
稍等一会之后，集群再次变得可用了。</p></blockquote><h2 id=问题记录>问题记录</h2><h3 id=1--client-port-not-found-in-server-configs>1 : Client port not found in server configs</h3><ul><li>参考官网 ZOO_SERVERS 的配置，以zoo1为例: server.1=zoo1:2888:3888 server.2=zoo2:2888:3888 server.3=zoo3:2888:3888 server.4=zoo4:2888:3888 没有加上端口号，实践后遇上了问题。</li><li>解决方案：立即停止和删除容器、网络、卷：<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose -f docker-compose.yml down
</span></span></code></pre></td></tr></table></div></div></li><li>然后，改成上面给出的 docker-compose.yml 文件内容，然后用 docker-compose -f docker-compose.yml up 重启集群服务器。</li></ul><h3 id=2-keepererrorcode--reconfig-is-disabled>2 :KeeperErrorCode = Reconfig is disabled</h3><ul><li><p>从3.5.0开始到3.5.3之前，没有办法禁用动态重新配置功能。我们希望提供禁用重新配置功能的选项，因为启用重新配置后，我们存在一个安全问题，即恶意参与者可以对ZooKeeper集合的配置进行任意更改，包括向集合中添加受损服务器。我们倾向于让用户自行决定是否启用它，并确保适当的安全措施到位。因此，在3.5.3中引入了reconfigEnabled configuration选项，以便可以完全禁用重新配置功能，并且通过reconfig API重新配置集群的任何尝试（无论是否具有身份验证）在默认情况下都将失败，除非reconfigEnabled设置为true。要将选项设置为true，配置文件（zoo.cfg）应包含：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>reconfigEnabled=true
</span></span></code></pre></td></tr></table></div></div></li></ul><h3 id=3-insufficient-permission>3: Insufficient permission</h3><ul><li>解决方案：addauth digest super:qwer1234 赋予超级管理员权限<div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-zed data-lang=zed><span class=line><span class=cl><span class=p>[</span><span class=n>zk</span><span class=o>:</span><span class=w> </span><span class=n>localhost</span><span class=o>:</span><span class=err>2181</span><span class=p>(</span><span class=n>CONNECTED</span><span class=p>)</span><span class=w> </span><span class=err>4</span><span class=p>]</span><span class=w> </span><span class=n>reconfig</span><span class=w> </span><span class=o>-</span><span class=n>remove</span><span class=w> </span><span class=err>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Insufficient</span><span class=w> </span><span class=kd>permission</span><span class=w> </span><span class=o>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=n>zk</span><span class=o>:</span><span class=w> </span><span class=n>localhost</span><span class=o>:</span><span class=err>2181</span><span class=p>(</span><span class=n>CONNECTED</span><span class=p>)</span><span class=w> </span><span class=err>5</span><span class=p>]</span><span class=w> </span><span class=n>addauth</span><span class=w> </span><span class=n>digest</span><span class=w> </span><span class=n>super</span><span class=o>:</span><span class=n>qwer1234</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=p>[</span><span class=n>zk</span><span class=o>:</span><span class=w> </span><span class=n>localhost</span><span class=o>:</span><span class=err>2181</span><span class=p>(</span><span class=n>CONNECTED</span><span class=p>)</span><span class=w> </span><span class=err>6</span><span class=p>]</span><span class=w> </span><span class=n>reconfig</span><span class=w> </span><span class=o>-</span><span class=n>remove</span><span class=w> </span><span class=err>3</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>Committed</span><span class=w> </span><span class=n>new</span><span class=w> </span><span class=n>configuration</span><span class=o>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>server</span><span class=p>.</span><span class=err>1</span><span class=o>=</span><span class=n>zoo1</span><span class=o>:</span><span class=err>2888</span><span class=o>:</span><span class=err>3888</span><span class=o>:</span><span class=n>participant</span><span class=p>;</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=o>:</span><span class=err>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>server</span><span class=p>.</span><span class=err>2</span><span class=o>=</span><span class=n>zoo2</span><span class=o>:</span><span class=err>2888</span><span class=o>:</span><span class=err>3888</span><span class=o>:</span><span class=n>participant</span><span class=p>;</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=o>:</span><span class=err>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>server</span><span class=p>.</span><span class=err>4</span><span class=o>=</span><span class=n>zoo4</span><span class=o>:</span><span class=err>2888</span><span class=o>:</span><span class=err>3888</span><span class=o>:</span><span class=n>participant</span><span class=p>;</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=p>.</span><span class=err>0</span><span class=o>:</span><span class=err>2181</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>version</span><span class=o>=</span><span class=err>300000001</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div></li></ul></div><script src=https://cdn.jsdelivr.net/gh/jmnote/plantuml-encoder@1.2.4/dist/plantuml-encoder.min.js integrity="sha256-Qsk2KRBCN5qVZX7B+8+2IvQl1Aqc723qV1tBCQaVoqo=" crossorigin=anonymous></script>
<script>(function(){let e="language-";Array.prototype.forEach.call(document.querySelectorAll("[class^="+e+"]"),function(e){if(console.info(e),e.innerText.indexOf("startuml")>0){console.log("is plantuml:"+e.innerText);let t=document.createElement("IMG");t.loading="lazy",t.src="http://www.plantuml.com/plantuml/svg/~1"+plantumlEncoder.encode(e.innerText),e.parentNode.parentNode.insertBefore(t,e.parentNode),e.style.display="none"}else console.log("not plantuml")})})()</script><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2023-08-15</span></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/zookeeper-cluster-demo/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=/zookeeper-cluster-demo/ data-title=使用Docker快速搭建ZooKeeper集群 data-hashtags="docker,docker compose,容器编排"><i class="fab fa-twitter fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=/zookeeper-cluster-demo/ data-hashtag=docker><i class="fab fa-facebook-square fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Hacker News" data-sharer=hackernews data-url=/zookeeper-cluster-demo/ data-title=使用Docker快速搭建ZooKeeper集群><i class="fab fa-hacker-news fa-fw" aria-hidden=true></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=/zookeeper-cluster-demo/ data-title=使用Docker快速搭建ZooKeeper集群><i data-svg-src=https://cdn.jsdelivr.net/npm/simple-icons@7.3.0/icons/line.svg aria-hidden=true></i></a><a href=javascript:void(0); title="Share on 微博" data-sharer=weibo data-url=/zookeeper-cluster-demo/ data-title=使用Docker快速搭建ZooKeeper集群><i class="fab fa-weibo fa-fw" aria-hidden=true></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw" aria-hidden=true></i>&nbsp;<a href=/tags/docker/>docker</a>,&nbsp;<a href=/tags/docker-compose/>docker compose</a>,&nbsp;<a href=/tags/%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92/>容器编排</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/demo-project-devops-record/ class=prev rel=prev title="演示项目-运维部署记录（demo project devops record）"><i class="fas fa-angle-left fa-fw" aria-hidden=true></i>演示项目-运维部署记录（demo project devops record）</a></div></div><div id=comments></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line>Powered by <a href=https://gohugo.io/ target=_blank rel="noopener noreffer" title="Hugo 0.114.0">Hugo</a> | Theme - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden=true></i> LoveIt</a></div><div class=footer-line itemscope itemtype=http://schema.org/CreativeWork><i class="far fa-copyright fa-fw" aria-hidden=true></i><span itemprop=copyrightYear>2021 - 2023</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Itlaohuo</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw" aria-hidden=true></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw" aria-hidden=true></i></a></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/css/lightgallery-bundle.min.css><script type=text/javascript src=https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/lightgallery.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/thumbnail/lg-thumbnail.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/lightgallery@2.5.0/plugins/zoom/lg-zoom.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js></script><script type=text/javascript src=https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},lightgallery:!0,search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>